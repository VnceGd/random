<!DOCTYPE html>
<!-- Vincent Nguyen 2018 -->
<!-- A remake of Dungeon Dilemma (github.com/vncegd/dungeon-proto) with no server side -->
<html>
  <head>
    <meta charset="UTF-8">
    <title>Dungeon Dilemma</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: sans-serif;
        transition: 2s;
      }

      /* TITLE SCREEN */
      .titleScreen {
        padding: 10%;
        text-align: center;
      }
      #settingsMenu, #helpMenu, #creditsScreen, #patchNotesScreen {
        display: none;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        color: #000;
        background-color: #000;
        background-color: rgba(0, 0, 0, 0.5);
        position: fixed;
        overflow: auto;
        z-index: 1;
      }
      .menu-content {
        margin: 10% auto;
        padding: 2vmin;
        width: 80%;
        background-color: #FAFAFA;
      }
      li {
        margin-left: 10px;
      }
      .backBtn {
        float: right;
      }
      #versionBtn {
        padding: 0 1vmin;
        width: auto;
        float: right;
      }
      .radioLabel {
        display: block;
        margin: 0.25vmin;
        padding: 0.5vmin 0 0.5vmin 4.5vmin;
        position: relative;
        width: 30%;
        font-size: 2vmin;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      .radioLabel input {
        position: absolute;
        opacity: 0;
      }
      .radioLabel:hover {
        background-color: #FFECB3; 
      }
      .checkmark {
        position: absolute;
        top: 0;
        left: 0;
        height: 2vmin;
        width: 2vmin;
        background-color: #FFF8E1;
        border: 0.5vmin solid #FFC107;
        border-radius: 50%;
      }
      .radioLabel input:checked ~ .checkmark  {
        background-color: #FFC107;
        border-color: #FF6F00;
      }
      .slider {
        -webkit-appearance: none;  /* Override default CSS styles */
        -moz-appearance: none;
        width: 50%;
        height: 1vmin;
        background-color: #9E9E9E;
        opacity: 0.8;
        border-radius: 2vmin;
      }
      .slider:hover {
        opacity: 1;
        cursor: pointer;
      }
      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        -moz-appearance: none;
        width: 1.75vmin;
        height: 1.75vmin;
        background-color: #FF8F00;
        border: 0.25vmin solid #FF6F00;
        border-radius: 2vmin;
      }
      .slider::-moz-range-thumb {
        width: 2vmin;
        height: 2vmin;
      }
      h1 {
        font-size: 5vmin;
      }
      h3 {
        font-size: 3.5vmin;
      }
      p {
        font-size: 2.5vmin;
      }
      button {
        margin: 1% 0;
        padding: 1%;
        width: 20%;
        border: 0.25vmin solid gray;
        border-radius: 10vmin;
        font-size: 2vmin;
        font-weight: bold;
        outline: none;
        cursor: pointer;
        transition: .1s;
      }
      button:focus, button:hover {
        background-color: whitesmoke;
        box-shadow: 0 0 0.2vmin 0.2vmin lightblue;
        
        transition: .1s;
      }
      .footer {
        position: fixed;
        left: 10%;
        bottom: 10%;
        width: 80%;
      }
      #author {
        margin-top: 1.5vmin;
        float: left;
      }
      #exitBtn {
        width: auto;
        padding: 0 1vmin;
      }
      #versionNo {
        float: right;
      }
      @media only screen and (max-width: 600px) {
        h1 {
          font-size: 2em;
        }
        button {
          font-size: 1em;
          width: 80%;
          border: 1px solid gray;
        }
      }
      
      /* GAME BOARD */
      .gameBoard {
        width: 100%;
      }
      .gameMenu {
        width: 80vmin;
        padding: 1% 0 0 10%;
      }
      .gameBoard button {
        padding: 1vmin 2vmin;
        width: auto;
      }
      table, tr, td {
        border: 1px solid #aaa;
        border-collapse: collapse;
      }
      table {
        left: 10%;
        position: absolute;
        width: 80vmin;
        height: 80vmin;
      }
      .fog {
        position: relative;
        width: 100%;
        height: 100%;
        background-color: #212121;
        transition: 2s;
        z-index: 3;
      }
      .discovered {
        background-color: white;
      }
      #player, #exit, .monster, .elite, .item {
        position: relative;
        margin: 0 2%;
        width: 45%;
        height: 45%;
        border-radius: 50%;
        float: right;
      }
      #player {
        background-image: radial-gradient(#B2EBF2, #00BCD4);
        float: left;
      }
      #exit {
        background-image: radial-gradient(#CFD8DC, #607D8B);
      }
      .exitSVG line {
        stroke: black;
        stroke-width: 1.5vmin;
      }
      .monster {
        background-image: radial-gradient(#F44336, #B71C1C);
      }
      .elite {
        background-image: radial-gradient(#BA68C8, #7B1FA2);
      }
      .item { 
        background-image: radial-gradient(#FFF176, #FBC02D);
      }
    </style>
    <script>
      // Difficulty values
      const EASY       = 0;
      const NORMAL     = 1;
      const HARD       = 2;
      const INSANE     = 3;
      const NIGHTMARE  = 4;
      const CUSTOM     = 5;
      // SVG Icons
      const PLAYER     = "<svg width='100%' viewbox='0 0 100 100'><polygon points='50,25 75,75 25,75'/></svg>";
      const EXIT       = "<svg class='exitSVG' width='100%' viewbox='0 0 100 100'><line x1='25' y1='5' x2='25' y2='75'/><line x1='75' y1='5' x2='75' y2='75'/><line x1='25' y1='20' x2='75' y2='20'/><line x1='25' y1='40' x2='75' y2='40'/><line x1='25' y1='60' x2='75' y2='60'/</svg>";
      const MONSTER    = "<svg width='100%' viewbox='0 0 100 100'><polygon points='50,25 75,50 50,75 25,50'/></svg>";
      const ELITE      = "<svg width='100%' viewbox='0 0 100 100'><polygon points='50,20 75,75 20,40 80,40 25,75'/></svg>";
      const ITEM       = "<svg width='100%' viewbox='0 0 100 100'><polygon points='25,35 35,25 65,25 75,35 75,45 25,45'/><polygon points='25,50 75,50 75,75 25,75'/></svg>";
      // Settings
      let difficulty   = 0;
      let room_count   = room_width = 5;
      let monster_rate = item_rate  = 4;
      let elite_rate   = 1;
      // Game State
      let room_number  = 1;
      let player_pos   = [0, 0];
      let exit_pos     = [1, 1];
      let keys         = {};

      // Change the advanced settings unless set to CUSTOM
      function updateDifficulty() {
        let roomCount   = document.getElementById("roomCount");
        let roomWidth   = document.getElementById("roomWidth");
        let monsterRate = document.getElementById("monSpawnRate");
        let eliteRate   = document.getElementById("eliteSpawnRate");
        let itemRate    = document.getElementById("itemSpawnRate");

        difficulty = parseInt(document.querySelector("input[name='difficulty']:checked").value);
        
        switch(difficulty) {
          case EASY:
            roomCount.value   = roomWidth.value = 4;
            monsterRate.value = 2;
            eliteRate.value   = 0;
            itemRate.value    = 5;
            break;
          default:
          case NORMAL:
            roomCount.value   = roomWidth.value = 5;
            monsterRate.value = 4;
            eliteRate.value   = 1;
            itemRate.value    = 4;
            break;
          case HARD:
            roomCount.value   = roomWidth.value = 6;
            monsterRate.value = 6;
            eliteRate.value   = 2;
            itemRate.value    = 3;
            break;
          case INSANE:
            roomCount.value   = roomWidth.value = 8;
            monsterRate.value = 10;
            eliteRate.value   = 3;
            itemRate.value    = 2;
            break;
          case NIGHTMARE:
            roomCount.value   = roomWidth.value = 10;
            monsterRate.value = 15;
            eliteRate.value   = 5;
            itemRate.value    = 1;
            break;
          case CUSTOM:
            break;
        }
        updateSettingsDisplay();
      }
      // Update display to show values of settings
      function updateSettingsDisplay() {
        let roomCountText  = document.getElementById("roomCountText");
        let roomWidthText  = document.getElementById("roomWidthText");
        let monSRText      = document.getElementById("monSpawnRateText");
        let eliteSRText    = document.getElementById("eliteSpawnRateText");
        let itemSRText     = document.getElementById("itemSpawnRateText");

        roomCountText.innerHTML = room_count   = parseInt(document.getElementById("roomCount").value);
        roomWidthText.innerHTML = room_width   = parseInt(document.getElementById("roomWidth").value);
        monSRText.innerHTML     = monster_rate = parseInt(document.getElementById("monSpawnRate").value);
        eliteSRText.innerHTML   = elite_rate   = parseInt(document.getElementById("eliteSpawnRate").value);
        itemSRText.innerHTML    = item_rate    = parseInt(document.getElementById("itemSpawnRate").value);
        document.getElementById("roomSizeText").innerHTML = room_width * room_width;
      }
      // Configure settings while maintaining limits
      function updateSettings() {
        let maxSpawns = 0;
        let currentSpawns  = monster_rate + elite_rate + item_rate;
        let monSpawnRate   = document.getElementById("monSpawnRate");
        let eliteSpawnRate = document.getElementById("eliteSpawnRate");
        let itemSpawnRate  = document.getElementById("itemSpawnRate");
        
        room_count = document.getElementById("roomCount").value;
        room_width = document.getElementById("roomWidth").value;
        maxSpawns  = roomWidth.value * roomWidth.value - 2;

        while(currentSpawns > maxSpawns) {
          if(monster_rate < elite_rate) {
            if(elite_rate < item_rate)
              itemSpawnRate.value = item_rate--;
            else 
              eliteSpawnRate.value = elite_rate--;
          }
          else if(monster_rate < item_rate) {
            itemSpawnRate.value = item_rate--;
          }
          else {
            monSpawnRate.value = monster_rate--;
          }
          currentSpawns = monster_rate + elite_rate + item_rate;
        }
        document.getElementById("roomSizeText").innerHTML = maxSpawns;
        monster_rate = parseInt(monSpawnRate.value);
        currentSpawns = monster_rate + elite_rate + item_rate;
        if(currentSpawns > maxSpawns) {
          monSpawnRate.value = monster_rate = maxSpawns - elite_rate - item_rate;
        }
        elite_rate = parseInt(eliteSpawnRate.value);
        currentSpawns = monster_rate + elite_rate + item_rate;
        if(currentSpawns > maxSpawns) {
          eliteSpawnRate.value = elite_rate = maxSpawns - monster_rate - item_rate;
        }
        item_rate = parseInt(itemSpawnRate.value);
        currentSpawns = monster_rate + elite_rate + item_rate;
        if(currentSpawns > maxSpawns) {
          itemSpawnRate.value = item_rate = maxSpawns - elite_rate - monster_rate;
        }
        document.getElementsByName("difficulty")[5].checked = true;
        updateDifficulty();
      }
      // Open or close a modal based on option
      function toggleMenu(option) {
        let menu;

        switch(option) {
          case 'settings':
            menu = document.getElementById("settingsMenu");
            break;
          case 'help':
            menu = document.getElementById("helpMenu");
            break;
          case 'credits':
            menu = document.getElementById("creditsScreen");
            break;
          case 'patchNotes':
            menu = document.getElementById("patchNotesScreen");
            break;
        }
        if(menu.style.display == "block")
          menu.style.display = "none";
        else
          menu.style.display = "block";
      }
      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function(event) {
        let settingsMenu     = document.getElementById("settingsMenu");
        let helpMenu         = document.getElementById("helpMenu");
        let creditsScreen    = document.getElementById("creditsScreen");
        let patchNotesScreen = document.getElementById("patchNotesScreen");

        if(event.target == settingsMenu)
          settingsMenu.style.display = "none";
        else if(event.target == helpMenu)
          helpMenu.style.display = "none";
        else if(event.target == creditsScreen)
          creditsScreen.style.display = "none";
        else if(event.target == patchNotesScreen)
          patchNotesScreen.style.display = "none";
      }

      // Listens for keypresses
      addEventListener("keydown", function(e) {
        keys[e.keyCode] = true
        movePlayer();
      }, false)
      addEventListener("keyup", function(e) {
        delete keys[e.keyCode]
      }, false)
      // Move the player token on keypress
      function movePlayer() {
        let up    = (38 in keys || 87 in keys);
        let down  = (40 in keys || 83 in keys);
        let left  = (37 in keys || 65 in keys);
        let right = (39 in keys || 68 in keys);
        let player;

        if($("#player").length < 1)
          return;

        if(up && player_pos[0] > 0)
          player_pos[0]--;
        else if(down && player_pos[0] < room_width - 1)
          player_pos[0]++;
        else if(left && player_pos[1] > 0)
          player_pos[1]--;
        else if(right && player_pos[1] < room_width - 1)
          player_pos[1]++;
        else
          return;
        player = document.getElementById("player");
        player.remove();
        updateBoard();
      }
      // Place the player on the board
      function placePlayer(row, col) {
        player_pos[0] = row;
        player_pos[1] = col;
      }
      // Place object in a random empty cell
      function placeRandom(object) {
        let cell;
        do {
          tempRow = Math.floor(Math.random() * room_width);
          tempCol = Math.floor(Math.random() * room_width);
          cell = document.getElementById(tempRow + "," + tempCol);
        } while(cell.innerHTML != "" || (tempRow == player_pos[0] && tempCol == player_pos[1]));
        if(object == 'exit') {
          exit_pos = [tempRow, tempCol];
          cell.innerHTML += "<div id='" + object + "'>" + EXIT + "</div>";
        }
        else {
          let str = "<div class='" + object + "'>";
          if(object == 'monster')
            str += MONSTER;
          else if(object == 'elite')
            str += ELITE;
          else if(object == 'item')
            str += ITEM;
          str += "</div>";
          cell.innerHTML += str;
        }
      }
      // Place fog over the whole room
      function placeFog() {
        let cell;

        for(let row = 0; row < room_width; row++) {
          for(let col = 0; col < room_width; col++) {
            cell = document.getElementById(row + "," + col);
            cell.innerHTML += "<div class='fog'></div>";
          }
        }
      }
      // Clear fog and trigger events
      function updateBoard() {
        let playerCell = document.getElementById(player_pos[0] + "," + player_pos[1]);
        let fog = $("#" + player_pos[0] + "\\," + player_pos[1] + " div.fog");

        if(fog.length > 0)
          fog[0].className = "discovered";
        playerCell.innerHTML += "<div id='player'>" + PLAYER + "</div>";
      }
      // Create a room according to settings
      function generateBoard() {
        let str     = "";
        let tempRow = tempCol = 0;

        for(let row = 0; row < room_width; row++) {
          str += "<tr style='height:" + 80/room_width + "%'>";
          for(let col = 0; col < room_width; col++) {
            str += "<td style='width:" + 80/room_width + "%' id='" + row + "," + col + "'></td>";
          }
          str += "</tr>";
        }
        document.getElementById("room").innerHTML = str;
        if(roomNo = 1)
          placePlayer(0, 0);
        else
          playePlayer(exit_pos[0], exit_pos[1]);
        placeRandom('exit');
        for(let i = 0; i < monster_rate; i++)
          placeRandom('monster');
        for(let j = 0; j < elite_rate; j++)
          placeRandom('elite');
        for(let k = 0; k < item_rate; k++)
          placeRandom('item');
        placeFog();
        updateBoard();
      }

      // Generate a table based on settings then display the gameBoard div
      function startGame() {
        document.getElementsByClassName("gameBoard")[0].style.display = "inline";
        document.getElementsByClassName("titleScreen")[0].style.display = "none";
        generateBoard();
        document.body.style.color = "#FFF";
        document.body.style.backgroundColor = "#263238";
      }
      // Return to the title screen
      function quitGame() {
        document.getElementsByClassName("gameBoard")[0].style.display = "none";
        document.getElementsByClassName("titleScreen")[0].style.display = "inline";
        document.body.style.color = "#000";
        document.body.style.backgroundColor = "#FFF";
      }
    </script>
  </head>
  <body>
    <div id="settingsMenu">
      <div class="menu-content">
        <button class="backBtn" onclick="toggleMenu('settings')">&#9668; Back</button>
        <h1>Settings</h1>
        <div id="basicSettings">
          <h3>Basic</h3>
          <p>
            <b>Difficulty:</b> <br>
            <label class="radioLabel">Easy 
              <input type="radio" name="difficulty" value="0" onchange="updateDifficulty()"/>
              <span class="checkmark"></span>
            </label>
            <label class="radioLabel">Normal 
              <input class="radio" type="radio" name="difficulty" value="1" onchange="updateDifficulty()" checked/>
              <span class="checkmark"></span> 
            </label>
            <label class="radioLabel">Hard 
              <input class="radio" type="radio" name="difficulty" value="2" onchange="updateDifficulty()"/>
              <span class="checkmark"></span> 
            </label>
            <label class="radioLabel">Insane 
              <input class="radio" type="radio" name="difficulty" value="3" onchange="updateDifficulty()"/>
              <span class="checkmark"></span> 
            </label>
            <label class="radioLabel">Nightmare 
              <input class="radio" type="radio" name="difficulty" value="4" onchange="updateDifficulty()"/>
              <span class="checkmark"></span> 
            </label>
            <label class="radioLabel">Custom 
              <input class="radio" type="radio" name="difficulty" value="5" onchange="updateDifficulty()"/>
              <span class="checkmark"></span> 
            </label>
          </p>
        </div>
        <div id="advSettings">
          <h3>Advanced</h3>
          <p>
            <b>Dungeon Length (# of Rooms)</b>: <span id="roomCountText">5</span> <br>
            <input id="roomCount" class="slider" type="range" min="3" max="15" value="5" oninput="updateSettings()"/> <br>
            <b>Room width</b>: <span id="roomWidthText">5</span> (Room size = <span id="roomSizeText">25</span>)<br>
            <input id="roomWidth" class="slider" type="range" min="3" max="12" value="5" oninput="updateSettings()"/> <br>
            <b>Monsters per room</b>: <span id="monSpawnRateText">4</span> <br>
            <input id="monSpawnRate" class="slider" type="range" min="1" max="50" value="4" oninput="updateSettings()"/> <br>
            <b>Elite Monsters per room</b>: <span id="eliteSpawnRateText">1</span> <br>
            <input id="eliteSpawnRate" class="slider" type="range" min="0" max="20" value="1" oninput="updateSettings()"/> <br>
            <b>Items per room</b>: <span id="itemSpawnRateText">4</span> <br>
            <input id="itemSpawnRate" class="slider" type="range" min="1" max="50" value="4" oninput="updateSettings()"/> <br>
          </p>
        </div>
      </div>
    </div>
    <div id="creditsScreen">
      <div class="menu-content">
        <button class="backBtn" onclick="toggleMenu('credits')">&#9668; Back</button>
        <h1>Credits</h1>
        <h3>Made By</h3>
        <p>
          Vincent Nguyen <br>
          <a href="https://github.com/vncegd">Github</a>
        </p>
        <h3>References</h3>
        <p>
          <a href="https://w3schools.com">W3Schools</a> (HTML, CSS, Javascript) <br>
          <a href="https://material.io/design/">Google Material Design</a> (Design, Colors) <br>
          <a href="https://github.com/vncegd/dungeon-proto">Dungeon Proto</a> (School project, Original inspiration)
        </p>
      </div>
    </div>
    <div id="patchNotesScreen">
      <div class="menu-content">
        <button class="backBtn" onclick="toggleMenu('patchNotes')">&#9668; Back</button>
        <h1>Patch Notes</h1>
        <h3>v0.1.1</h3>
        <b>Updates:</b>
          <li>WASD Movement</li>
          <li>Icons created for board tokens</li>
          <li>Fog added to dungeon rooms</li>
          <li>Fixed 'Credits' button opening patch notes</li>
        <h3>v0.1.0</h3>
        <b>This version includes:</b>
          <li>Basic UI Interaction</li>
          <li>Ability to change settings/difficulty</li>
          <li>Room generation</li>
      </div>
    </div>
    <div id="helpMenu">
      <div class="menu-content">
        <button class="backBtn" onclick="toggleMenu('help')">&#9668; Back</button>
        <h1>How to Play</h1>
        <p>
          Battle & loot your way through a series of rooms populated by monsters. <br>
          Reach the end to win. <br>
          <i>Gameplay not yet implemented.</i>
          <hr>
          <b>Controls:</b> <br>
          <svg width="20vmin" viewbox="0 0 100 100">
            <text x="0" y="20" fill="black">Movement</text>
            <g>
              <polygon points="35,35 65,35 65,65 35,65" style="fill: gainsboro"/>
              <text x="50" y="50" fill="black" text-anchor="middle" alignment-baseline="central">W</text>
            </g>
            <g>
              <polygon points="0,70 30,70 30,100 0,100" style="fill: gainsboro"/>
              <text x="15" y="85" fill="black" text-anchor="middle" alignment-baseline="central">A</text>
            </g>
            <g>
              <polygon points="35,70 65,70 65,100 35,100" style="fill: gainsboro"/>
              <text x="50" y="85" fill="black" text-anchor="middle" alignment-baseline="central">S</text>
            </g>
            <g>
              <polygon points="70,70 100,70 100,100 70,100" style="fill: gainsboro"/>
              <text x="85" y="85" fill="black" text-anchor="middle" alignment-baseline="central">D</text>
            </g>
          </svg>
        </p>
      </div>
    </div>
    <div class="titleScreen">
      <h1>DUNGEON DILEMMA</h1>
      <div class="buttonBox">
        <button onclick="startGame()">Play</button> <br>
        <button onclick="toggleMenu('settings')">Settings</button> <br>
        <button onclick="toggleMenu('help')">How to Play</button> <br>
        <button onclick="toggleMenu('credits')">Credits</button>
      </div>
      <div class="footer">
        <span id="author"><img style="width: 2vmin" src="images/GitHub-Mark-120px-plus.png"/> VnceGd</span>
        <a href="index.html"><button id="exitBtn">Exit</button></a>
        <button id="versionBtn" onclick="toggleMenu('patchNotes')"><span id="versionNo">v0.1.1</span></button>
      </div>
    </div>
    <div class="gameBoard" style="display:none">
      <div class="gameMenu">
        <button class="backBtn" onclick="quitGame()">Quit</button>
        <button>Room <span id="roomNo">1</span></button>
        <button>Inventory</button>
        <button onclick="toggleMenu('help')">?</button> <br>
      </div>
      <table id="room"></table>
    </div>
  </body>
</html>