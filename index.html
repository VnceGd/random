<!DOCTYPE html>
<!-- Vincent Nguyen 2018 -->
<!-- JavaScript practice using RNG -->
<html>
  <head>
    <meta charset="UTF-8">
    <title> Random </title>
    <link rel="icon" type="image/png" href="./images/dieFavicon.png">
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <style>
      html, body {
        margin: 0;
        font-family: 'Lato', Arial, Helvetica, sans-serif;
      }
      a {
        text-decoration: none;
      }
      h1, h2, h3, p {
        margin: 1vmin;
      }
      input {
        padding: 1vmin;
        font-size: 1rem;
      }
      button {
        margin: 0;
        padding: 1vmin 2vmin;
        box-sizing: border-box;
        color: #FFF;
        background-color: #000;
        font-size: 1rem;
        font-family: 'Lato', sans-serif;
        outline: none;
        transition: .1s;
      }
      button:hover {
        background-color: #222;
        box-shadow: 0vmin 0.5vmin #aaa;
        transition: .2s;
      }
      button:active {
        background-color: #555;
        box-shadow: 0vmin 0.5vmin #eee;
        transition: .2s;
      }
      .container {
        padding: 2vmin;
      }
      .header, .gameMenu, .inputArea, .resultArea {
        width: 100%;
        float: left;
      }
      .header {
        background-color: #eee;
      }
      .title {
        margin: 0;
        width: 70vmin;
        float: left;
      }
      .author {
        margin: 0;
        width: 20vmin;
        font-size: 2vmin;
        text-align: right;
        float: right;
      }
      .gameMenu {
        background-color: #ddd;
      }
      #author {
        float: right;
      }
      #output {
        font-size: 2rem;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="container">
        <div class="title">
          <h1>Test Your Luck </h1>
          <p>Fun with random number generation</p>
        </div>
        <div class="author">
          <p>Vincent Nguyen 2018</p>
        </div>
      </div>
    </div>
    <div class="gameMenu">
      <div class="container">
        <!-- LINKS -->
        <h2>Games <span style="font-size: .85rem">(<a href="./misc/cookies.html">Manage Cookies</a>) (<a href="https://goo.gl/forms/6cPtaJFhn3hFaYCF2">Feedback</a>)</span></h2>
        <a href="./game/snake_v2.html"><button>Snake</button></a>
        <a href="./game/yahtzee_v2.html"><button>Yahtzee</button></a>
        <a href="./game/blackjack_v2.html"><button>Blackjack</button></a>
        <a href="./game/dungeon.html"><button>Dungeon</button></a>
      </div>
    </div>
    <!-- INPUT AREA -->
    <div class="inputArea">
      <div class="container">
        <h2>Dice Roll</h2>
        <p>
          # of Dice: 
          <input type="text" id="diceCount" value="1" onchange="checkDice()">
          # of Sides: 
          <input type="text" id="diceSides" value="6" onchange="checkDice()">
          <button onclick="rollDice()">Roll</button>
        </p>
        <h2>Card Picker (Standard 52-card deck)</h2>
        <p>
          # of Cards:
          <input type="text" id="cardCount" value="1" onchange="checkCards()">
          # of Decks:
          <input type="text" id="deckCount" value="1">
          <button onclick="drawCards()">Draw</button>
        </p>
      </div>
    </div>
    <!-- RESULTS AREA -->
    <div class="resultArea">
      <div class="container">
        <h3>Results</h3>
        <p>
          Preference: 
          <input type="radio" name="pref" value="icon" checked> Symbols
          <input type="radio" name="pref" value="text"> Text
        </p>
        <p id="output"></p>
      </div>
    </div>
    <script>
      // Check if input for dice roll is valid
      function checkDice() {
        let count = document.getElementById("diceCount");
        let sides = document.getElementById("diceSides");
        if(!Number.isInteger(parseInt(count.value)) || count.value < 1)
          count.value = 1;
        if(!Number.isInteger(parseInt(sides.value)) || sides.value < 2)
          sides.value = 6;
      }
      // Rolls sets of dice, returning values and total
      function rollDice() {
        let count = document.getElementById("diceCount");
        let sides = document.getElementById("diceSides");
        let output = document.getElementById("output");   
        let stack = [];
        let sum = 0;

        output.innerHTML = "Rolled: ";
        for(let i = 0; i < count.value; i++) {
          stack[i] = Math.floor(Math.random() * sides.value) + 1;
          if(preferIcons() && sides.value == 6) {
            switch(stack[i]) {
              case 1:
                output.innerHTML += "&#9856; ";
                break;
              case 2:
                output.innerHTML += "&#9857; ";
                break;
              case 3:
                output.innerHTML += "&#9858; ";
                break;
              case 4:
                output.innerHTML += "&#9859; ";
                break;
              case 5:
                output.innerHTML += "&#9860; ";
                break;
              case 6:
                output.innerHTML += "&#9861; ";
                break;
            }
          }
          else {        
            output.innerHTML += stack[i];
            if(i < count.value - 1)
              output.innerHTML += ", ";
          }
        }
        if(count.value > 1) {
          for(let j = 0; j < count.value; j++) {
            sum += stack[j];
          }
          output.innerHTML += "<br> Total: " + sum;
        }
      }
      
      // Converts face cards from numbers to text
      function convertFace(n) {
        if(preferIcons()) {
          switch(n) {
            case 1 :
              return "A";
            case 11:
              return "J";
            case 12:
              return "Q";
            case 13:
              return "K";
            default:
              return n;
          }
        }
        else { 
          switch(n) {
            case 1 :
              return "Ace";
            case 11:
              return "Jack";
            case 12:
              return "Queen";
            case 13:
              return "King";
            default:
              return n;
          }
        }
      }
      // Converts suits from numbers to text
      function convertSuit(n) {
        if(preferIcons()) {
          switch(n) {
            case 0:
              return "&spades;";
            case 1:
              return "&clubs;";
            case 2:
              return "&diams;";
            case 3:
              return "&hearts;";
          }
        }
        else {
          switch(n) {
            case 0:
              return " of Clubs";
            case 1:
              return " of Spades";
            case 2:
              return " of Diamonds";
            case 3:
              return " of Hearts";
          }
        }
      }
      // Checks if number of cards exceeds maximum available in decks
      function checkCards() {
        let numCards = document.getElementById("cardCount");
        let numDecks = document.getElementById("deckCount");
        
        if(!Number.isInteger(parseInt(numCards.value)) || numCards.value < 1) {
          numCards.value = 1;
        }
        if(!Number.isInteger(parseInt(numDecks.value)) || numDecks.value < 1) {
          numDecks.value = 1;
        }
        if(numCards.value > numDecks.value * 52)
          numCards.value = numDecks.value * 52;
      }
      // Draws cards randomly from 52-card deck(s)
      function drawCards() {
        let numCards = document.getElementById("cardCount");
        let numDecks = document.getElementById("deckCount");
        let output = document.getElementById("output");
        let deckCollection = [];
        let card = [];
        let number = 1;

        // Shuffle a deck using Fisher-Yates (Knuth) Shuffle
        function shuffle(array) {
          let currentIndex = array.length, temporaryValue, randomIndex;

          // While there remain elements to shuffle...
          while (0 !== currentIndex) {

            // Pick a remaining element...
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex -= 1;

            // And swap it with the current element.
            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
          }
          
          return array;
        }

        // Generate deck(s)
        function generateDecks() {
          let deck = [];
          for(let n = 1; n < 14; n++) {
            for(let s = 0; s < 4; s++) {
              let newCard = [n, s];
              deck.push(newCard);
            }
          }
          for(let i = 0; i < numDecks.value; i++) {
            let shuffledDeck = [];
            shuffledDeck = shuffle(deck).slice();
            deckCollection.push(shuffledDeck);
          }
        }
        
        // Main of drawCards()
        generateDecks();
        if(numCards.value == 1)
          output.innerHTML = "Card drawn: ";
        else
          output.innerHTML = "Cards drawn: ";
        if(deckCollection.length == 0) {
          console.log("Err");
          return;
        }
        for(let i = 0; i < numCards.value; i++) {
          do {
            number = Math.floor(Math.random() * numDecks.value);
          } while(deckCollection[number].length == 0);
          card = deckCollection[number].pop();
          output.innerHTML += convertFace(card[0]) + convertSuit(card[1]);
          if (i < numCards.value - 1)
            output.innerHTML += ", ";
        }
      }
      // Determine whether to display icons or text
      function preferIcons() {
        let pref = document.querySelector('input[name = "pref"]:checked');

        if(pref.value == "icon")
          return true;
        else
          return false;
      }
    </script>
  </body>
</html>